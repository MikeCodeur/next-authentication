Strategy Pattern

### 💡 Comprendre Strategy Pattern

## 📝 Tes notes

Detaille ce que tu as appris ici, sur une page [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Dans le développement de logiciels, il est souvent nécessaire de pouvoir modifier le comportement d'un objet sans changer son code source. C'est là que le pattern Strategy intervient. Ce pattern permet de définir une famille d'algorithmes, de les encapsuler individuellement et de les rendre interchangeables. Cela permet de varier l'algorithme ou la logique utilisée par un objet sans altérer son fonctionnement global.

Le pattern Strategy est particulièrement utile dans les situations où plusieurs algorithmes pour effectuer une tâche sont disponibles et où l'algorithme à utiliser peut varier en fonction du contexte. Ce pattern favorise également la réutilisabilité du code et la séparation des préoccupations.

### Exemple Pratique dans Next.js

Pour illustrer le pattern Strategy, prenons l'exemple de la gestion des sessions utilisateur dans une application Next.js. Selon l'environnement ou les exigences spécifiques, vous pouvez choisir de gérer les sessions de manière **stateless** (sans état) ou en les stockant dans une **base de données**. Le pattern Strategy permet de basculer entre ces deux méthodes de manière transparente.

### Définition des Stratégies

Nous avons developper deux stratégies pour la gestion des sessions :

1. **Stateless** : Les sessions sont gérées sans état, souvent à l'aide de JSON Web Tokens (JWT).
2. **Database** : Les sessions sont stockées dans une base de données.

Nous avons des fonctions spécifiques pour chaque méthode de gestion des sessions :

- `createSession`
- `verifySession`
- `updateSession`
- `deleteSession`

Chacune de ces fonctions a une implémentation pour chaque stratégie.

### Implémentation du Pattern Strategy

L’idée est que les couches qui appellent les fonctions de sessions n’ont pas a ce préoccuper du type de gestion de session.

Pour cela nous allons interdire ce type d’import spécifique

```tsx
//❌
import {createSession, deleteSession} from './session-database'
//❌
import {createSession, deleteSession} from './session-stateless'

// Mais on autorise
//✅
import {createSession, deleteSession} from './session'
```

Il est possible de définir des règles au niveau du `linter` pour interdire ces imports

```json
//.eslintrc.json
"no-restricted-imports": [
      "error",
      {
        "paths": [
          {
            "name": "./session-stateless",
            "importNames": ["createSession", "deleteSession", "verifySession"],
            "message": "Do not import these session management functions from this module."
          },
          {
            "name": "./session-database",
            "importNames": ["createSession", "deleteSession", "verifySession"],
            "message": "Do not import these session management functions from this module."
          }
        ]
      }
    ]
```

## Exercice

Dans cet exercice tu as un type à disposition : `SessionType`

```tsx
export enum SessionType {
  STATELESS = 'STATELESS',
  DATABASE = 'DATABASE',
}
```

Et le type de session sera définis en variable d’environnement

```json
SESSION_TYPE=DATABASE
```

Pour déterminer le type il suffira de faire dans notre fichier `session.ts`

```tsx
const SESSION_TYPE: SessionType = process.env.SESSION_TYPE as SessionType
```

Pour les besoins de l’exercice nous avons modifier tous les imports de sessions dans `auth.ts et dal.ts` et nous avons maintenant un fichier `sessions.ts` qui appelle la version stateless

```tsx
export async function createSession(userId: string) {
  return await createSessionStateLess(userId)
}
export async function verifySession() {
  return await verifySessionStateless()
}
export async function updateSession() {
  return await updateSessionStateLess()
}

export function deleteSession() {
  return deleteSessionStateLess()
}
```

- **🐶 Implémente le stategy pattern pour pouvoir switcher d’implementation en fonction de** `SESSION_TYPE` défini dans le `.env`

ps : pense à tester tous les cas de types de sessions

```tsx
//.env
SESSION_TYPE=DATABASE
SESSION_TYPE=STATELESS
SESSION_TYPE=
```

Fichiers

- `exercise/auth/lib/session.ts`

## Aller plus loin

📑 Le lien vers la doc [https://en.wikipedia.org/wiki/Strategy_pattern](https://en.wikipedia.org/wiki/Strategy_pattern)

## Ils vont t’aider

- **🐶 Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **🤖 Ash le Robot** : _Ash le Robot te donnera du code utile._
- **🚀 Julia La roquette** : _Julia te donnera des défis supplémentaires._
- **⛏️ Hulk le Marteau** : _Quand du code à supprimer est présent_
- **👨‍✈️ Hugo le chef de projet** : _Va t'aider sur les spécifications du projet_

## 🐜 Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20PRO&entry.1430994900=5.Next%20Auth&entry.533578441=09-stategy-pattern).
