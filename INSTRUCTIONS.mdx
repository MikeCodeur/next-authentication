# HOC User Session

### 💡 Protéger des routes avec un HOC

## 📝 Tes notes

Détaille ce que tu as appris ici, sur une page [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Nous avons maintenant une `session` qui permet de récupérer un `user` connecté. Nous avons créé la fonction `getConnectedUser` (que nous avons déplacée dans `dal.ts`) qui nous permet de détecter si un `user` est connecté et de gérer l’affichage en fonction, exemple :

```tsx
function Page() {
  const user = await getConnectedUser()
  return (
    <div className="mx-auto max-w-2xl space-y-8 p-6 text-center text-lg">
      {user ? (
        <Label>Hello {user.email}</Label>
      ) : (
        <Label>You are not connected</Label>
      )}
    </div>
  )
}
export default Page
```

Ce qui revient à

```tsx
function Page() {
  const user = await getConnectedUser()
  if (!user) {
    return <Label>You are not connected</Label>
  }

  return (
    <div className="mx-auto max-w-2xl space-y-8 p-6 text-center text-lg">
      <Label>Hello {user.email}</Label>
    </div>
  )
}
export default Page
```

On pourrait ajouter ce bout de code dans toutes nos routes protégées

```tsx
const user = await getConnectedUser()
if (!user) {
  return <Label>You are not connected</Label>
}
```

Mais on va toujours dupliquer beaucoup de code, ce qui rend la maintenance compliquée (Ne respecte pas le principe `DRY`: [Don't Repeat Yourself](https://en.wikipedia.org/wiki/Don%27t_repeat_yourself))

Pour protéger nos routes, nous allons utiliser un [HOC : High Order Component](https://blog.logrocket.com/understanding-react-higher-order-components/) . Les 3 points d’un `HOC` :

- 1. Réutilisation de la Logique des Composants.
- 2. Manipulation des `Props`.
- 3. Abstraction et Découplage.

Exemple :

```tsx
import React, { useState, useEffect } from 'react';

const withEnhancement = (BaseComponent) => {
 // HOC logic using hooks
 return function EnhancedComponent(props) {
   // HOC-specific logic using hooks
   return (
     <BaseComponent {...props} enhancedProp="someValue" />
   );
 };
};
//utilisation
function NormalComponent {return <></>}
return withEnhancement(NormalComponent)
```

## Exercice

**🐶** Dans cet exercice, tu vas devoir créer un `HOC` qui aura pour but de :

- Récupérer le user connecté avec `getConnectedUser`.
- Afficher : `You are not connected` si pas de `user`.
- Injecter le `props user` au composant afin qu’il puisse être utilisé.

🐶 Utilise ensuite ce HOC dans `/auth/page` et les routes protégées.

Fichiers

- `exercise/auth/lib/withAuth.tsx`
- `exercise/auth/page.tsx`

## Bonus

### 1. 🚀 Protéger les routes `dashboard` et `bank-account`

**🐶** Protège les routes `dashboard` et `bank-account` avec le `HOC`.

**🐶** Ajoute également le `HOC` sur `Logout` car on doit être connecté pour pouvoir `logout`.

Fichiers

- `exercise/bank-account/page`
- `exercise/dashboard/page`
- `exercise/dashboard/logout`

## Aller plus loin

📑 Le lien vers la doc [https://blog.logrocket.com/understanding-react-higher-order-components/](https://blog.logrocket.com/understanding-react-higher-order-components/)

## Ils vont t’aider

- **🐶 Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **🤖 Ash le Robot** : _Ash le Robot te donnera du code utile._
- **🚀 Julia La roquette** : _Julia te donnera des défis supplémentaires._
- **⛏️ Hulk le Marteau** : _Quand du code à supprimer est présent_
- **👨‍✈️ Hugo le chef de projet** : _Va t'aider sur les spécifications du projet_

## 🐜 Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20PRO&entry.1430994900=05.Next%20Auth&entry.533578441=06%20HOC%20User%20Session).
